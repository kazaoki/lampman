# Do not edit this file as it will update automatically !
# Built by Lampman ver 1.0.18 @ 2020-10-26 17:16:33
version: '2.2'
services:
  lampman:
    container_name: lampman-test-prod-lampman
    image: kazaoki/lampman
    ports:
      - '443:443'
    depends_on:
      - phpenv
    environment:
      LAMPMAN_MODE: product
      LAMPMAN_APACHE_START: 1
      LAMPMAN_PHP_PHPENV_IMAGE: 'kazaoki/phpenv:7.3.6'
      LAMPMAN_PHP_PHPENV_VERSION: 7.3.6
      LAMPMAN_POSTFIX_START: 1
      LAMPMAN_BIND_HOSTS: 'main.db:lampman-test-prod-mysql'
      LAMPMAN_MYSQLS: mysql
    volumes_from:
      - phpenv
    volumes:
      - './:/lampman'
      - '../public_html:/var/www/html'
    entrypoint: /lampman/lampman/entrypoint.sh
  phpenv:
    container_name: lampman-test-prod-phpenv
    image: 'kazaoki/phpenv:7.3.6'
    labels:
      - lampman-test-prod
  mysql:
    container_name: lampman-test-prod-mysql
    image: 'mysql:5.7'
    ports:
      - '3306:3306'
    volumes:
      - './mysql:/mysql'
      - 'mysql_data:/var/lib/mysql'
      - './mysql/dump.sql:/docker-entrypoint-initdb.d/dump.sql'
    entrypoint: /mysql/entrypoint.sh
    command:
      - mysqld
      - '--character-set-server=utf8mb4'
      - '--collation-server=utf8mb4_general_ci'
    labels:
      - lampman-test-prod
    environment:
      MYSQL_ROOT_PASSWORD: test
      MYSQL_DATABASE: test
      MYSQL_USER: test
      MYSQL_PASSWORD: test
      VOLUME_LOCKED: 1
      QUERY_CACHE: 1
      DUMP_ROTATIONS: 3
      DUMP_FILENAME: dump.sql
volumes:
  mysql_data:
    driver: local
    name: locked_lampman-test-prod-mysql_data
networks: {}
