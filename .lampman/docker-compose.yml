# Do not edit this file as it will update automatically !
version: '2.2'
services:
  lampman:
    container_name: lampman-test-lampman
    image: kazaoki/lampman
    ports:
      - '80:80'
      - '443:443'
      - '9981:1080'
      - '2222:22'
    depends_on:
      - phpenv
    environment:
      LAMPMAN_MODE: default
      LAMPMAN_APACHE_START: 1
      LAMPMAN_APACHE_REWRITE_LOG: 8
      LAMPMAN_PHP_PHPENV_IMAGE: 'kazaoki/phpenv:5.6.22'
      LAMPMAN_PHP_PHPENV_VERSION: 5.6.22
      LAMPMAN_PHP_ERROR_REPORT: 1
      LAMPMAN_PHP_XDEBUG_START: 1
      LAMPMAN_PHP_XDEBUG_HOST: 192.168.0.10
      LAMPMAN_PHP_XDEBUG_PORT: 9000
      LAMPMAN_MAILDEV_START: 1
      LAMPMAN_MAILDEV_PORTS: '9981:1080'
      LAMPMAN_POSTFIX_START: 1
      LAMPMAN_SSHD_START: 1
      LAMPMAN_SSHD_PORTS: '2222:22'
      LAMPMAN_SSHD_USER: sshuser
      LAMPMAN_SSHD_PASS: '123456'
      LAMPMAN_SSHD_PATH: /var/www/html
      LAMPMAN_BIND_HOSTS: >-
        main.db:mysql, main-2.db:mysql_2, sub.db:postgresql,
        sub-b.db:postgresql_b
      LAMPMAN_MYSQLS: 'mysql, mysql_2'
      LAMPMAN_POSTGRESQLS: 'postgresql, postgresql_b'
    volumes_from:
      - phpenv
      - mysql
    volumes:
      - './:/lampman'
      - '../public_html:/var/www/html'
      - '../public_html:/home/user_a/public_html'
    entrypoint: /lampman/lampman/entrypoint.sh
  phpenv:
    container_name: lampman-test-phpenv
    image: 'kazaoki/phpenv:5.6.22'
    labels:
      - lampman-test
  mysql:
    container_name: lampman-test-mysql
    image: 'mysql:5.7'
    ports:
      - '3306:3306'
    volumes:
      - './mysql:/mysql'
      - 'mysql_data:/var/lib/mysql'
      - 'mysql_querylogs:/var/log/mysql'
      - './mysql/dump.sql:/docker-entrypoint-initdb.d/import.sql'
    entrypoint: /mysql/entrypoint.sh
    command:
      - mysqld
      - '--character-set-server=utf8mb4'
      - '--collation-server=utf8mb4_unicode_ci'
    labels:
      - lampman-test
    environment:
      MYSQL_ROOT_PASSWORD: test
      MYSQL_DATABASE: test
      MYSQL_USER: test
      MYSQL_PASSWORD: test
      VOLUME_LOCKED: 0
      QUERY_LOGS: 1
      LAMPMAN_SERVICE: mysql
      QUERY_CACHE: 1
      DUMP_ROTATIONS: 3
      DUMP_FILENAME: dump.sql
  mysql_2:
    container_name: lampman-test-mysql_2
    image: 'mysql:5.5'
    ports:
      - '3307:3306'
    volumes:
      - './mysql_2:/mysql'
      - 'mysql_2_data:/var/lib/mysql'
      - './mysql_2/dump.sql:/docker-entrypoint-initdb.d/import.sql'
    entrypoint: /mysql/entrypoint.sh
    command:
      - mysqld
      - '--character-set-server=utf8mb4'
      - '--collation-server=utf8mb4_unicode_ci'
    labels:
      - lampman-test
    environment:
      MYSQL_ROOT_PASSWORD: test2
      MYSQL_DATABASE: test2
      MYSQL_USER: test2
      MYSQL_PASSWORD: test2
      VOLUME_LOCKED: 0
      DUMP_ROTATIONS: 5
      DUMP_FILENAME: dump.sql
  postgresql:
    container_name: lampman-test-postgresql
    image: 'postgres:9'
    ports:
      - '5432:5432'
    volumes:
      - './postgresql:/postgresql'
      - 'postgresql_data:/var/lib/postgresql/data'
      - './postgresql/dump.sql:/docker-entrypoint-initdb.d/import.sql'
    entrypoint: /postgresql/entrypoint.sh
    command: postgres
    labels:
      - lampman-test
    environment:
      POSTGRES_PASSWORD: test
      POSTGRES_USER: test
      POSTGRES_DB: test
      VOLUME_LOCKED: 1
      DUMP_ROTATIONS: 5
      DUMP_FILENAME: dump.sql
  postgresql_b:
    container_name: lampman-test-postgresql_b
    image: kazaoki/postgres-bigm
    ports:
      - '5433:5432'
    volumes:
      - './postgresql_b:/postgresql'
      - 'postgresql_b_data:/var/lib/postgresql/data'
      - './postgresql_b/dump.sql:/docker-entrypoint-initdb.d/import.sql'
    entrypoint: /postgresql/entrypoint.sh
    command: postgres
    labels:
      - lampman-test
    environment:
      POSTGRES_PASSWORD: testb
      POSTGRES_USER: testb
      POSTGRES_DB: testb
      VOLUME_LOCKED: 0
      DUMP_ROTATIONS: 3
      DUMP_FILENAME: dump.sql
volumes:
  mysql_querylogs:
    driver: local
    name: lampman-test-mysql_querylogs
  mysql_data:
    driver: local
    name: lampman-test-mysql_data
  mysql_2_data:
    driver: local
    name: lampman-test-mysql_2_data
  postgresql_data:
    driver: local
    name: locked_lampman-test-postgresql_data
  postgresql_b_data:
    driver: local
    name: lampman-test-postgresql_b_data
networks: {}
